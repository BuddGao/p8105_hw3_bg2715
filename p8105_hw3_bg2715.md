p8105\_hw2\_bg2715
================

## Problem 1

Loading data.

``` r
data("instacart")
instacart %>%
  head(3)
```

    ## # A tibble: 3 x 15
    ##   order_id product_id add_to_cart_order reordered user_id eval_set order_number
    ##      <int>      <int>             <int>     <int>   <int> <chr>           <int>
    ## 1        1      49302                 1         1  112108 train               4
    ## 2        1      11109                 2         1  112108 train               4
    ## 3        1      10246                 3         0  112108 train               4
    ## # ... with 8 more variables: order_dow <int>, order_hour_of_day <int>,
    ## #   days_since_prior_order <int>, product_name <chr>, aisle_id <int>,
    ## #   department_id <int>, aisle <chr>, department <chr>

Short description: This dataset has 1384617 rows and 15 columns. Each
row represent a single item ordered and each column represent a
feature/information of that order. Key variables are “aisle”,
“product\_name”, “order\_dow”, “order\_hour\_of\_day” and so on. For
example, the first line means user 112108 ordered bulgarian yogurt from
aisle yogurt in department dairy eggs at ten o’clock on Thursday.

``` r
ai_df = instacart %>%
  count(aisle) %>%
  arrange(-n)
  knitr::kable(head(ai_df[1:4, ]))
```

| aisle                      |      n |
|:---------------------------|-------:|
| fresh vegetables           | 150609 |
| fresh fruits               | 150473 |
| packaged vegetables fruits |  78493 |
| yogurt                     |  55240 |

There are 134 aisles and the most items ordered from “fresh vegetables”
and “fresh fruits” aisles.

``` r
ai_plot = instacart %>%
  count(aisle) %>%
  filter(n > 10000) %>%
  arrange(n) 

ggplot(ai_plot, aes(x = aisle, y = n)) + geom_point() + 
  theme(axis.text.x = element_text(angle = 75, hjust = 0.5, vjust = 0.5))
```

<img src="p8105_hw3_bg2715_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

Most of them are less than 40000.

``` r
bdp_df = instacart %>%
  filter(aisle %in% c("baking ingredients", 
                      "dog food care", 
                      "packaged vegetables fruits")) %>%  
  group_by(aisle, product_name) %>%
  summarise(n_times = n()) %>%
  top_n(n = 3)
```

    ## `summarise()` has grouped output by 'aisle'. You can override using the `.groups` argument.

    ## Selecting by n_times

``` r
  knitr::kable(bdp_df)
```

| aisle                      | product\_name                                 | n\_times |
|:---------------------------|:----------------------------------------------|---------:|
| baking ingredients         | Cane Sugar                                    |      336 |
| baking ingredients         | Light Brown Sugar                             |      499 |
| baking ingredients         | Pure Baking Soda                              |      387 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |       28 |
| dog food care              | Small Dog Biscuits                            |       26 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |       30 |
| packaged vegetables fruits | Organic Baby Spinach                          |     9784 |
| packaged vegetables fruits | Organic Blueberries                           |     4966 |
| packaged vegetables fruits | Organic Raspberries                           |     5546 |

The most popular item in “baking ingredients”, “dog food care”, and
“packaged vegetables fruits” is “Light Brown Sugar” (499), “Snack Sticks
Chicken & Rice Recipe Dog Treats” (30) and “Organic Baby Spinach” (9784)
respectively.

``` r
pc_df = instacart %>%
  filter(product_name %in% c("Pink Lady Apples",
                             "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarise(mean_hour = mean(order_hour_of_day)) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) 
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the `.groups` argument.

``` r
colnames(pc_df) = c('product_name', 'Sun', 'Mon', 
                    'Tue', 'Wed', 'Thu', 'Fri', 'Sat')
knitr::kable(pc_df)
```

| product\_name    |      Sun |      Mon |      Tue |      Wed |      Thu |      Fri |      Sat |
|:-----------------|---------:|---------:|---------:|---------:|---------:|---------:|---------:|
| Coffee Ice Cream | 13.77419 | 14.31579 | 15.38095 | 15.31818 | 15.21739 | 12.26316 | 13.83333 |
| Pink Lady Apples | 13.44118 | 11.36000 | 11.70213 | 14.25000 | 11.55172 | 12.78431 | 11.93750 |

The mean hour of ordering of coffee ice cream is greater than that of
pink lady apples except for Friday.

## Problem 2

Do some data cleaning.

``` r
data("brfss_smart2010")

brfss_df = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health", response %in% 
           c("Excellent","Very good","Good","Fair","Poor")) %>%
  mutate(response = recode(response,
        "Poor" = "1","Fair" = "2","Good" = "3",
        "Very good" = "4","Excellent" = "5"
        )) %>% 
      arrange(response) %>%  
  mutate(response = recode(response,
        "1" = "Poor","2" = "Fair","3" = "Good",
        "4" = "Very good","5" = "Excellent"
    ))
colnames(brfss_df)[2:3] = c("state","location")
knitr::kable(head(brfss_df[1:4, ]))
```

| year | state | location               | class         | topic          | question                    | response | sample\_size | data\_value | confidence\_limit\_low | confidence\_limit\_high | display\_order | data\_value\_unit | data\_value\_type | data\_value\_footnote\_symbol | data\_value\_footnote | data\_source | class\_id | topic\_id | location\_id | question\_id | respid  | geo\_location           |
|-----:|:------|:-----------------------|:--------------|:---------------|:----------------------------|:---------|-------------:|------------:|-----------------------:|------------------------:|---------------:|:------------------|:------------------|:------------------------------|:----------------------|:-------------|:----------|:----------|:-------------|:-------------|:--------|:------------------------|
| 2010 | AL    | AL - Jefferson County  | Health Status | Overall Health | How is your general health? | Poor     |           45 |         5.5 |                    3.5 |                     7.4 |              5 | %                 | Crude Prevalence  | NA                            | NA                    | BRFSS        | CLASS08   | Topic41   | NA           | GENHLTH      | RESP060 | (33.518601, -86.814688) |
| 2010 | AL    | AL - Mobile County     | Health Status | Overall Health | How is your general health? | Poor     |           66 |         6.4 |                    4.4 |                     8.3 |              5 | %                 | Crude Prevalence  | NA                            | NA                    | BRFSS        | CLASS08   | Topic41   | NA           | GENHLTH      | RESP060 | (30.683993, -88.170637) |
| 2010 | AL    | AL - Tuscaloosa County | Health Status | Overall Health | How is your general health? | Poor     |           35 |         4.2 |                    2.6 |                     5.7 |              5 | %                 | Crude Prevalence  | NA                            | NA                    | BRFSS        | CLASS08   | Topic41   | NA           | GENHLTH      | RESP060 | (33.214154, -87.520229) |
| 2010 | AZ    | AZ - Maricopa County   | Health Status | Overall Health | How is your general health? | Poor     |           62 |         3.5 |                    2.3 |                     4.6 |              5 | %                 | Crude Prevalence  | NA                            | NA                    | BRFSS        | CLASS08   | Topic41   | NA           | GENHLTH      | RESP060 | (33.493403, -112.04143) |

``` r
st_loc02 = brfss_df %>%
  filter(year == "2002") %>%
  group_by(state) %>%
  summarise(location = n()) %>%
  filter(location >= 7) %>%
  arrange(-location)
knitr::kable(head(st_loc02[1:4, ]))
```

| state | location |
|:------|---------:|
| PA    |       50 |
| MA    |       40 |
| NJ    |       40 |
| CT    |       35 |

``` r
st_loc10 = brfss_df %>%
  filter(year == "2010") %>%
  group_by(state) %>%
  summarise(location = n()) %>%
  filter(location >= 7) %>%
  arrange(-location)
knitr::kable(head(st_loc10[1:4, ]))
```

| state | location |
|:------|---------:|
| FL    |      205 |
| NJ    |       95 |
| TX    |       80 |
| CA    |       60 |

In 2002, there were 36 states that were observed at 7 or more locations
and Pennsylvania were observed at 50 locations. In 2010, there were 45
states that were observed at 7 or more locations and Florida were
observed at 205 locations.

``` r
spag_df = brfss_df %>%
  filter(response == "Excellent") %>%
  group_by(state, year) %>%
  summarise(mean_data_value = mean(data_value, na.rm = TRUE))
```

    ## `summarise()` has grouped output by 'state'. You can override using the `.groups` argument.

``` r
knitr::kable(head(spag_df[1:4, ]))
```

| state | year | mean\_data\_value |
|:------|-----:|------------------:|
| AK    | 2002 |             27.90 |
| AK    | 2003 |             24.85 |
| AK    | 2004 |             23.05 |
| AK    | 2005 |             23.85 |

``` r
ggplot(spag_df, aes(x = year, y = mean_data_value,
                    color = state), show.legend = FALSE) + 
  geom_line(aes(group = state), alpha = 0.5) + 
  theme(legend.position = "right")
```

<img src="p8105_hw3_bg2715_files/figure-gfm/unnamed-chunk-8-1.png" width="90%" />

Different states had different trends. Most of mean\_data\_value were
between 15 and 30.

``` r
panel_df = brfss_df %>%
  filter(state == "NY",
         year %in% c("2006", "2010")) %>% 
  mutate(response = factor(
    response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent")))


ggplot(panel_df, aes(x = response, y = data_value)) + 
  geom_point() + 
  facet_grid(.~year)
```

<img src="p8105_hw3_bg2715_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

The distributions of data\_value for responses in NY State are similar
for the year 2006 and 2010.
